kind: pipeline
name: validate

steps:
  - name: GB Build Docs
    image: node
    commands:
      - yarn install
      - yarn build
    environment:
      DEPLOYMENT_BRANCH: master
      USE_SSH: true
      GIT_USER:
        from_secret: gh_username
      GITHUB_PRIVATE_KEY:
        from_secret: git_deploy_private_key

trigger:
  event:
    - pull_request
---
kind: pipeline
type: docker
name: publish

steps:
  - name: GB Deploy Docs
    image: node
    commands:
      - mkdir -p $HOME/.ssh
      - ssh-keyscan -t rsa github.com >> $HOME/.ssh/known_hosts
      - echo "$GITHUB_PRIVATE_KEY" > "$HOME/.ssh/id_rsa"
      - chmod 0600 $HOME/.ssh/id_rsa
      - yarn install
      - yarn deploy
    environment:
      DEPLOYMENT_BRANCH: master
      USE_SSH: true
      GIT_USER:
        from_secret: gh_username
      GITHUB_PRIVATE_KEY:
        from_secret: git_deploy_private_key

trigger:
  event:
    - push
  branch:
    - main
